resources:
- name: complex_command
  type: smuggler
  source:
    smuggler_params:
      param1: test
      param2: true
      param3: 123
    commands:
    # Check command
    - name: check
      path: bash
      args:
      - -e
      - -c
      - |
        echo Command Start
        echo "action=${SMUGGLER_ACTION}"
        echo "command=${SMUGGLER_COMMAND}"
        echo "version=${SMUGGLER_VERSION_ID}"
        echo "param1=${SMUGGLER_param1}"
        echo "param2=${SMUGGLER_param2}"
        echo "param3=${SMUGGLER_param3}"
        echo "1.2.3" > ${SMUGGLER_OUTPUT_DIR}/versions
        echo -e "\n   " >> ${SMUGGLER_OUTPUT_DIR}/versions
        echo -e "\t 1.2.4  \n" >> ${SMUGGLER_OUTPUT_DIR}/versions
        echo Command End 1>&2
    # In command
    - name: in
      path: bash
      args:
      - -e
      - -c
      - |
        echo Command Start
        echo "version=${SMUGGLER_VERSION_ID}"
        echo "destinationDir=${SMUGGLER_DESTINATION_DIR}"
        echo "action=${SMUGGLER_ACTION}"
        echo "command=${SMUGGLER_COMMAND}"
        echo "param1=${SMUGGLER_param1}"
        echo "param2=${SMUGGLER_param2}"
        echo "param3=${SMUGGLER_param3}"
        echo "param4=${SMUGGLER_param4}"
        echo "param5=${SMUGGLER_param5}"
        echo "action=${SMUGGLER_ACTION}"
        echo "action=${SMUGGLER_COMMAND}"
        echo "value1= something quite long  " > ${SMUGGLER_OUTPUT_DIR}/metadata
        echo -e "\n   " >> ${SMUGGLER_OUTPUT_DIR}/metadata
        echo -e "\t value_2=2  \n" >> ${SMUGGLER_OUTPUT_DIR}/metadata
        echo Command End 1>&2
    # Out command
    - name: out
      path: bash
      args:
      - -e
      - -c
      - |
        echo Command Start
        echo "sourcesDir=$SMUGGLER_SOURCES_DIR"
        echo "action=${SMUGGLER_ACTION}"
        echo "command=${SMUGGLER_COMMAND}"
        echo "param1=${SMUGGLER_param1}"
        echo "param2=${SMUGGLER_param2}"
        echo "param3=${SMUGGLER_param3}"
        echo "param4=${SMUGGLER_param4}"
        echo "param5=${SMUGGLER_param5}"
        echo "1.2.3" > ${SMUGGLER_OUTPUT_DIR}/versions
        echo "value1= something quite long  " > ${SMUGGLER_OUTPUT_DIR}/metadata
        echo -e "\n   " >> ${SMUGGLER_OUTPUT_DIR}/metadata
        echo -e "\t value_2=2  \n" >> ${SMUGGLER_OUTPUT_DIR}/metadata
        echo Command End 1>&2

- name: fail_command
  type: smuggler
  source:
    commands:
    - name: check
      path: bash
      args:
      - -e
      - -c
      - |
        exit 2
    - name: out
      path: bash
      args:
      - -e
      - -c
      - |
        exit 2
    - name: in
      path: bash
      args:
      - -e
      - -c
      - |
        exit 2

- name: dummy_command
  type: smuggler

- name: empty_command_with_params
  type: smuggler
  source:
    smuggler_params:
      param1: test

- name: dump_request_from_stdin
  type: smuggler
  source:
    commands:
    - name: in
      path: bash
      args:
      - -e
      - -c
      - |
        cat > ${SMUGGLER_DESTINATION_DIR}/stdin.json

- name: write_response_to_stdout
  type: smuggler
  source:
    commands:
    - name: in
      path: bash
      args:
      - -e
      - -c
      - |
        cat <<EOF
        {
          "version": "3.2.1",
          "metadata": [
            { "name": "value_from_json", "value": "something" },
            { "name": "other_value_from_json", "value": "otherthing" }
          ]
        }
        EOF

- name: json_in_params_and_versions
  type: smuggler
  source:
    commands:
    - name: in
      path: bash
      args:
      - -e
      - -c
      - |
        echo "complex_param=$SMUGGLER_complex_param"
        echo '{"ref": "someid"}' > ${SMUGGLER_OUTPUT_DIR}/versions
    smuggler_params:
      complex_param:
        with: "keys"
        and: [ "other", "complex" ]
        structures: { like: "this" }

jobs:
  - name: a_job
    plan:
      - get: complex_command
        params:
          param4: val4
          param5: "something with spaces"
      - put: complex_command
        params:
          param4: val4
          param5: "something with spaces"
      - get: dump_request_from_stdin
        params:
          simple_string_params: "something with spaces"
          complex_param:
            with: "keys"
            and: [ "other", "complex" ]
            structures: { like: "this" }


